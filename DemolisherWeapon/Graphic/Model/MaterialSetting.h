#pragma once

namespace DemolisherWeapon {

	class ModelEffect;

	//定数バッファ　[model.fx:MaterialCb]
	//マテリアルパラメーター
	struct MaterialParam {
		CVector4 albedoScale = CVector4::One();	//アルベドにかけるスケール
		CVector3 emissive;						//エミッシブ(自己発光)
		int isLighting = 1;						//ライティングするか
	};

	class MaterialSetting
	{
	public:

		void Init(ModelEffect* modeleffect);

		//名前を設定
		void SetMatrialName(const wchar_t* matName)
		{
			m_materialName = matName;
		}
		//名前を取得
		const wchar_t* GetMatrialName()const {
			return m_materialName.c_str();
		}
		//名前の一致を判定
		bool EqualMaterialName(const wchar_t* name) const
		{
			return wcscmp(name, m_materialName.c_str()) == 0;
		}

		//ライティングするかを設定
		void SetLightingEnable(bool enable) {
			m_materialParam.isLighting = enable ? 1 : 0;
		}

		//自己発光色(エミッシブ)を設定
		void SetEmissive(const CVector3& emissive) {
			m_materialParam.emissive = emissive;
		}

		//アルベドにかけるスケールを設定
		void SetAlbedoScale(const CVector4& scale) {
			m_materialParam.albedoScale = scale;
		}

		//マテリアルパラメータ取得
		const MaterialParam& GetMaterialParam()const {
			return m_materialParam;
		}
		//マテリアルパラメータ設定
		void SetMaterialParam(const MaterialParam& param){
			m_materialParam = param;
		}

		//シェーダを取得
		Shader* GetPS() const{
			return m_pPSShader;
		}
		//シェーダを設定
		void SetPS(Shader* ps) {
			m_pPSShader = ps;
		}
		//シェーダをデフォに戻す
		void SetDefaultPS();

		//アルベドテクスチャを取得
		ID3D11ShaderResourceView* GetAlbedoTexture()const {
			return m_pAlbedoTex;
		}
		//アルベドテクスチャを設定
		void SetAlbedoTexture(ID3D11ShaderResourceView* tex){

			if (m_pAlbedoTex == tex) { return; }//既に

			if (m_pAlbedoTex) { 
				m_pAlbedoTex->Release();
			}
			m_pAlbedoTex = tex;
			m_pAlbedoTex->AddRef();
		}
		//アルベドテクスチャをデフォに戻す
		void SetDefaultAlbedoTexture();

		//モーションブラー有効かを設定
		void SetIsMotionBlur(bool enable) {
			m_isMotionBlur = enable;
		}
		//モーションブラー有効かを取得
		bool GetIsMotionBlur() const{
			return m_isMotionBlur;
		}
		
	private:
		ModelEffect *m_isInit = nullptr;

		std::wstring m_materialName;						//マテリアル名
		MaterialParam m_materialParam;						//マテリアルパラメータ
		Shader* m_pPSShader = nullptr;						//シェーダー
		ID3D11ShaderResourceView* m_pAlbedoTex = nullptr;	//テクスチャ

		bool m_isMotionBlur = true;//モーションブラー
	};

}